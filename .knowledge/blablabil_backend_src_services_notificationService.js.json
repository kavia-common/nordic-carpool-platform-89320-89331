{"is_source_file": true, "format": "JavaScript", "description": "This source file implements a NotificationService class in JavaScript, providing methods for sending email, SMS, and push notifications, as well as managing notification records and templates within a Node.js project. It integrates with nodemailer and Twilio for external communication, and interacts with a database for storing and retrieving notification data.", "external_files": ["../config/database", "../config/config"], "external_methods": ["require('nodemailer')", "require('twilio')", "query", "transaction"], "published": ["NotificationService", "sendNotification", "sendEmail", "sendSMS", "sendPushNotification", "getUserNotifications", "markNotificationAsRead", "markAllNotificationsAsRead", "sendBookingConfirmation", "sendTripReminder"], "classes": [{"name": "NotificationService", "description": "Class providing methods for managing and sending various types of notifications, including email, SMS, and push, as well as handling notification templates and user notification records."}], "methods": [{"name": "sendNotification(userId, templateName, templateData, channels = ['email'])", "description": "Main method to send notifications via specified channels (email, sms, push) based on user preferences and templates.", "scope": "NotificationService", "scopeKind": "class"}, {"name": "sendEmail(email, subject, message, notificationId)", "description": "Sends an email notification using nodemailer and updates notification status in the database.", "scope": "NotificationService", "scopeKind": "class"}, {"name": "sendSMS(phoneNumber, message, notificationId)", "description": "Sends an SMS notification via Twilio and updates notification status.", "scope": "NotificationService", "scopeKind": "class"}, {"name": "sendPushNotification(userId, title, message, notificationId)", "description": "Placeholder method for sending push notifications; currently logs the notification and updates status.", "scope": "NotificationService", "scopeKind": "class"}, {"name": "getUserNotifications(userId, unreadOnly = false, limit = 20, offset = 0)", "description": "Retrieves notifications for a user, optionally filtered for unread only.", "scope": "NotificationService", "scopeKind": "class"}, {"name": "markNotificationAsRead(notificationId, userId)", "description": "Marks a specific notification as read for a user.", "scope": "NotificationService", "scopeKind": "class"}, {"name": "markAllNotificationsAsRead(userId)", "description": "Marks all notifications as read for a user.", "scope": "NotificationService", "scopeKind": "class"}, {"name": "sendBookingConfirmation(bookingId)", "description": "Generates and sends booking confirmation notifications (email and SMS) for a booking.", "scope": "NotificationService", "scopeKind": "class"}, {"name": "sendTripReminder(tripId)", "description": "Sends trip reminder notifications (SMS) to all passengers of a trip.", "scope": "NotificationService", "scopeKind": "class"}, {"name": "constructor()", "scope": "NotificationService", "scopeKind": "class", "description": "unavailable"}, {"name": "formatEmailMessage(message)", "scope": "NotificationService", "scopeKind": "class", "description": "unavailable"}, {"name": "getChannelTemplate(templateName, channel, language)", "scope": "NotificationService", "scopeKind": "class", "description": "unavailable"}, {"name": "renderTemplate(template, data)", "scope": "NotificationService", "scopeKind": "class", "description": "unavailable"}], "calls": ["query", "transaction", "this.getChannelTemplate", "this.renderTemplate", "this.formatEmailMessage", "this.sendEmail", "this.sendSMS", "this.sendPushNotification", "console.log"], "search-terms": ["notificationService", "sendNotification", "sendEmail", "sendSMS", "sendPushNotification", "trip_reminder", "booking_confirmation"], "state": 2, "file_id": 24, "knowledge_revision": 49, "git_revision": "", "ctags": [{"_type": "tag", "name": "NotificationService", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^class NotificationService {$/", "language": "JavaScript", "kind": "class"}, {"_type": "tag", "name": "booking_id", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^        booking_id: booking.id$/", "language": "JavaScript", "kind": "property", "scope": "NotificationService.sendTripReminder.templateData", "scopeKind": "class"}, {"_type": "tag", "name": "booking_id", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^      booking_id: booking.id,$/", "language": "JavaScript", "kind": "property", "scope": "NotificationService.sendBookingConfirmation.templateData", "scopeKind": "class"}, {"_type": "tag", "name": "config", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^const config = require('..\\/config\\/config');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "constructor", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^  constructor() {$/", "language": "JavaScript", "kind": "method", "signature": "()", "scope": "NotificationService", "scopeKind": "class"}, {"_type": "tag", "name": "date", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^      date: new Date(booking.departure_time).toLocaleDateString('nb-NO'),$/", "language": "JavaScript", "kind": "property", "scope": "NotificationService.sendBookingConfirmation.templateData", "scopeKind": "class"}, {"_type": "tag", "name": "destination", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^        destination: booking.destination_city,$/", "language": "JavaScript", "kind": "property", "scope": "NotificationService.sendTripReminder.templateData", "scopeKind": "class"}, {"_type": "tag", "name": "destination", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^      destination: booking.destination_city,$/", "language": "JavaScript", "kind": "property", "scope": "NotificationService.sendBookingConfirmation.templateData", "scopeKind": "class"}, {"_type": "tag", "name": "exports", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^module.exports = new NotificationService();$/", "language": "JavaScript", "kind": "variable", "scope": "module", "scopeKind": "class"}, {"_type": "tag", "name": "formatEmailMessage", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^  formatEmailMessage(message) {$/", "language": "JavaScript", "kind": "method", "signature": "(message)", "scope": "NotificationService", "scopeKind": "class"}, {"_type": "tag", "name": "from", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^        from: config.email.smtp.user,$/", "language": "JavaScript", "kind": "property", "scope": "NotificationService.sendEmail.mailOptions", "scopeKind": "class"}, {"_type": "tag", "name": "getChannelTemplate", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^  async getChannelTemplate(templateName, channel, language) {$/", "language": "JavaScript", "kind": "method", "signature": "(templateName, channel, language)", "scope": "NotificationService", "scopeKind": "class"}, {"_type": "tag", "name": "getUserNotifications", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^  async getUserNotifications(userId, unreadOnly = false, limit = 20, offset = 0) {$/", "language": "JavaScript", "kind": "method", "signature": "(userId, unreadOnly = false, limit = 20, offset = 0)", "scope": "NotificationService", "scopeKind": "class"}, {"_type": "tag", "name": "hours", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^        hours: hoursUntilDeparture,$/", "language": "JavaScript", "kind": "property", "scope": "NotificationService.sendTripReminder.templateData", "scopeKind": "class"}, {"_type": "tag", "name": "html", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^        html: this.formatEmailMessage(message),$/", "language": "JavaScript", "kind": "property", "scope": "NotificationService.sendEmail.mailOptions", "scopeKind": "class"}, {"_type": "tag", "name": "mailOptions", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^      const mailOptions = {$/", "language": "JavaScript", "kind": "class", "scope": "NotificationService.sendEmail", "scopeKind": "class"}, {"_type": "tag", "name": "markAllNotificationsAsRead", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^  async markAllNotificationsAsRead(userId) {$/", "language": "JavaScript", "kind": "method", "signature": "(userId)", "scope": "NotificationService", "scopeKind": "class"}, {"_type": "tag", "name": "markNotificationAsRead", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^  async markNotificationAsRead(notificationId, userId) {$/", "language": "JavaScript", "kind": "method", "signature": "(notificationId, userId)", "scope": "NotificationService", "scopeKind": "class"}, {"_type": "tag", "name": "nodemailer", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^const nodemailer = require('nodemailer');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "origin", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^        origin: booking.origin_city,$/", "language": "JavaScript", "kind": "property", "scope": "NotificationService.sendTripReminder.templateData", "scopeKind": "class"}, {"_type": "tag", "name": "origin", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^      origin: booking.origin_city,$/", "language": "JavaScript", "kind": "property", "scope": "NotificationService.sendBookingConfirmation.templateData", "scopeKind": "class"}, {"_type": "tag", "name": "passenger_name", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^        passenger_name: `${booking.first_name} ${booking.last_name}`,$/", "language": "JavaScript", "kind": "property", "scope": "NotificationService.sendTripReminder.templateData", "scopeKind": "class"}, {"_type": "tag", "name": "passenger_name", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^      passenger_name: `${booking.first_name} ${booking.last_name}`,$/", "language": "JavaScript", "kind": "property", "scope": "NotificationService.sendBookingConfirmation.templateData", "scopeKind": "class"}, {"_type": "tag", "name": "price", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^      price: booking.total_price,$/", "language": "JavaScript", "kind": "property", "scope": "NotificationService.sendBookingConfirmation.templateData", "scopeKind": "class"}, {"_type": "tag", "name": "renderTemplate", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^  renderTemplate(template, data) {$/", "language": "JavaScript", "kind": "method", "signature": "(template, data)", "scope": "NotificationService", "scopeKind": "class"}, {"_type": "tag", "name": "seats", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^      seats: booking.seats_booked,$/", "language": "JavaScript", "kind": "property", "scope": "NotificationService.sendBookingConfirmation.templateData", "scopeKind": "class"}, {"_type": "tag", "name": "sendBookingConfirmation", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^  async sendBookingConfirmation(bookingId) {$/", "language": "JavaScript", "kind": "method", "signature": "(bookingId)", "scope": "NotificationService", "scopeKind": "class"}, {"_type": "tag", "name": "sendEmail", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^  async sendEmail(email, subject, message, notificationId) {$/", "language": "JavaScript", "kind": "method", "signature": "(email, subject, message, notificationId)", "scope": "NotificationService", "scopeKind": "class"}, {"_type": "tag", "name": "sendNotification", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^  async sendNotification(userId, templateName, templateData, channels = ['email']) {$/", "language": "JavaScript", "kind": "method", "signature": "(userId, templateName, templateData, channels = ['email'])", "scope": "NotificationService", "scopeKind": "class"}, {"_type": "tag", "name": "sendPushNotification", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^  async sendPushNotification(userId, title, message, notificationId) {$/", "language": "JavaScript", "kind": "method", "signature": "(userId, title, message, notificationId)", "scope": "NotificationService", "scopeKind": "class"}, {"_type": "tag", "name": "sendSMS", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^  async sendSMS(phoneNumber, message, notificationId) {$/", "language": "JavaScript", "kind": "method", "signature": "(phoneNumber, message, notificationId)", "scope": "NotificationService", "scopeKind": "class"}, {"_type": "tag", "name": "sendTripReminder", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^  async sendTripReminder(tripId) {$/", "language": "JavaScript", "kind": "method", "signature": "(tripId)", "scope": "NotificationService", "scopeKind": "class"}, {"_type": "tag", "name": "subject", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^        subject: subject,$/", "language": "JavaScript", "kind": "property", "scope": "NotificationService.sendEmail.mailOptions", "scopeKind": "class"}, {"_type": "tag", "name": "templateData", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^      const templateData = {$/", "language": "JavaScript", "kind": "class", "scope": "NotificationService.sendTripReminder", "scopeKind": "class"}, {"_type": "tag", "name": "templateData", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^    const templateData = {$/", "language": "JavaScript", "kind": "class", "scope": "NotificationService.sendBookingConfirmation", "scopeKind": "class"}, {"_type": "tag", "name": "text", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^        text: message$/", "language": "JavaScript", "kind": "property", "scope": "NotificationService.sendEmail.mailOptions", "scopeKind": "class"}, {"_type": "tag", "name": "time", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^      time: new Date(booking.departure_time).toLocaleTimeString('nb-NO', { hour: '2-digit', minu/", "language": "JavaScript", "kind": "property", "scope": "NotificationService.sendBookingConfirmation.templateData", "scopeKind": "class"}, {"_type": "tag", "name": "to", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^        to: email,$/", "language": "JavaScript", "kind": "property", "scope": "NotificationService.sendEmail.mailOptions", "scopeKind": "class"}, {"_type": "tag", "name": "trip_id", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^        trip_id: tripId,$/", "language": "JavaScript", "kind": "property", "scope": "NotificationService.sendTripReminder.templateData", "scopeKind": "class"}, {"_type": "tag", "name": "trip_id", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^      trip_id: booking.trip_id$/", "language": "JavaScript", "kind": "property", "scope": "NotificationService.sendBookingConfirmation.templateData", "scopeKind": "class"}, {"_type": "tag", "name": "twilio", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/notificationService.js", "pattern": "/^const twilio = require('twilio');$/", "language": "JavaScript", "kind": "constant"}], "hash": "c4cbf3cc03ae5cca54e4be0286624d7c", "format-version": 4, "code-base-name": "blablabil_backend", "filename": "blablabil_backend/src/services/notificationService.js", "fields": [{"name": "booking_id: booking.id", "scope": "NotificationService.sendTripReminder.templateData", "scopeKind": "class", "description": "unavailable"}, {"name": "booking_id: booking.id,", "scope": "NotificationService.sendBookingConfirmation.templateData", "scopeKind": "class", "description": "unavailable"}, {"name": "date: new Date(booking.departure_time).toLocaleDateString('nb-NO'),", "scope": "NotificationService.sendBookingConfirmation.templateData", "scopeKind": "class", "description": "unavailable"}, {"name": "destination: booking.destination_city,", "scope": "NotificationService.sendTripReminder.templateData", "scopeKind": "class", "description": "unavailable"}, {"name": "module.exports = new NotificationService();", "scope": "module", "scopeKind": "class", "description": "unavailable"}, {"name": "from: config.email.smtp.user,", "scope": "NotificationService.sendEmail.mailOptions", "scopeKind": "class", "description": "unavailable"}, {"name": "hours: hoursUntilDeparture,", "scope": "NotificationService.sendTripReminder.templateData", "scopeKind": "class", "description": "unavailable"}, {"name": "html: this.formatEmailMessage(message),", "scope": "NotificationService.sendEmail.mailOptions", "scopeKind": "class", "description": "unavailable"}, {"name": "origin: booking.origin_city,", "scope": "NotificationService.sendTripReminder.templateData", "scopeKind": "class", "description": "unavailable"}, {"name": "passenger_name: `${booking.first_name} ${booking.last_name}`,", "scope": "NotificationService.sendTripReminder.templateData", "scopeKind": "class", "description": "unavailable"}, {"name": "price: booking.total_price,", "scope": "NotificationService.sendBookingConfirmation.templateData", "scopeKind": "class", "description": "unavailable"}, {"name": "seats: booking.seats_booked,", "scope": "NotificationService.sendBookingConfirmation.templateData", "scopeKind": "class", "description": "unavailable"}, {"name": "subject: subject,", "scope": "NotificationService.sendEmail.mailOptions", "scopeKind": "class", "description": "unavailable"}, {"name": "text: message", "scope": "NotificationService.sendEmail.mailOptions", "scopeKind": "class", "description": "unavailable"}, {"name": "time: new Date(booking.departure_time).toLocaleTimeString('nb-NO', { hour: '2-digit', minu/", "scope": "NotificationService.sendBookingConfirmation.templateData", "scopeKind": "class", "description": "unavailable"}, {"name": "to: email,", "scope": "NotificationService.sendEmail.mailOptions", "scopeKind": "class", "description": "unavailable"}, {"name": "trip_id: tripId,", "scope": "NotificationService.sendTripReminder.templateData", "scopeKind": "class", "description": "unavailable"}, {"name": "trip_id: booking.trip_id", "scope": "NotificationService.sendBookingConfirmation.templateData", "scopeKind": "class", "description": "unavailable"}], "revision_history": [{"49": ""}]}