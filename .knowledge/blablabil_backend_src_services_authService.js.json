{"is_source_file": true, "format": "JavaScript", "description": "This is a JavaScript source file defining an AuthService class that manages authentication-related functionalities such as generating tokens, refreshing tokens, password management, session validation, and user verification.", "external_files": ["../config/database", "../config/config"], "external_methods": ["query", "transaction"], "published": ["new AuthService()"], "classes": [{"name": "AuthService", "description": "A class providing authentication services including token management, password resets, session validation, and user verification."}], "methods": [{"name": "generateTokens(user)", "description": "Generates JWT access and refresh tokens for a user, and stores a session in the database.", "scope": "AuthService", "scopeKind": "class"}, {"name": "refreshToken(refreshToken)", "description": "Refreshes access tokens using a valid refresh token, verifying user activity.", "scope": "AuthService", "scopeKind": "class"}, {"name": "createPasswordResetToken(email)", "description": "Creates a password reset token associated with a user email.", "scope": "AuthService", "scopeKind": "class"}, {"name": "resetPassword(token, newPassword)", "description": "Resets the user's password using a valid reset token, hashes the new password, and invalidates sessions.", "scope": "AuthService", "scopeKind": "class"}, {"name": "changePassword(userId, currentPassword, newPassword)", "description": "Allows user to change their password after verifying current password.", "scope": "AuthService", "scopeKind": "class"}, {"name": "logout(userId, sessionToken)", "description": "Logs out a user by invalidating their session(s).", "scope": "AuthService", "scopeKind": "class"}, {"name": "verifyEmail(userId, verificationToken)", "description": "Verifies a user's email address.", "scope": "AuthService", "scopeKind": "class"}, {"name": "verifyPhone(userId, verificationCode)", "description": "Verifies a user's phone number.", "scope": "AuthService", "scopeKind": "class"}, {"name": "cleanupExpiredTokens()", "description": "Removes expired sessions and password reset tokens.", "scope": "AuthService", "scopeKind": "class"}, {"name": "getUserSessions(userId)", "description": "Retrieves active sessions for a user.", "scope": "AuthService", "scopeKind": "class"}, {"name": "validateSession(sessionToken)", "description": "Validates a session token and retrieves session info if valid.", "scope": "AuthService", "scopeKind": "class"}], "calls": ["jwt.sign", "crypto.randomBytes", "query", "transaction", "bcrypt.hash", "bcrypt.compare", "client.query", "query", "client.query", "query", "query", "query", "query", "query"], "search-terms": ["AuthService", "generateTokens", "refreshToken", "createPasswordResetToken", "resetPassword", "changePassword", "logout", "verifyEmail", "verifyPhone", "cleanupExpiredTokens", "getUserSessions", "validateSession"], "state": 2, "file_id": 20, "knowledge_revision": 41, "git_revision": "", "ctags": [{"_type": "tag", "name": "AuthService", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/authService.js", "pattern": "/^class AuthService {$/", "language": "JavaScript", "kind": "class"}, {"_type": "tag", "name": "bcrypt", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/authService.js", "pattern": "/^const bcrypt = require('bcryptjs');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "changePassword", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/authService.js", "pattern": "/^  async changePassword(userId, currentPassword, newPassword) {$/", "language": "JavaScript", "kind": "method", "signature": "(userId, currentPassword, newPassword)", "scope": "AuthService", "scopeKind": "class"}, {"_type": "tag", "name": "cleanupExpiredTokens", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/authService.js", "pattern": "/^  async cleanupExpiredTokens() {$/", "language": "JavaScript", "kind": "method", "signature": "()", "scope": "AuthService", "scopeKind": "class"}, {"_type": "tag", "name": "config", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/authService.js", "pattern": "/^const config = require('..\\/config\\/config');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "createPasswordResetToken", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/authService.js", "pattern": "/^  async createPasswordResetToken(email) {$/", "language": "JavaScript", "kind": "method", "signature": "(email)", "scope": "AuthService", "scopeKind": "class"}, {"_type": "tag", "name": "crypto", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/authService.js", "pattern": "/^const crypto = require('crypto');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "email", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/authService.js", "pattern": "/^      email: user.email,$/", "language": "JavaScript", "kind": "property", "scope": "AuthService.generateTokens.payload", "scopeKind": "class"}, {"_type": "tag", "name": "exports", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/authService.js", "pattern": "/^module.exports = new AuthService();$/", "language": "JavaScript", "kind": "variable", "scope": "module", "scopeKind": "class"}, {"_type": "tag", "name": "generateTokens", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/authService.js", "pattern": "/^  async generateTokens(user) {$/", "language": "JavaScript", "kind": "method", "signature": "(user)", "scope": "AuthService", "scopeKind": "class"}, {"_type": "tag", "name": "getUserSessions", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/authService.js", "pattern": "/^  async getUserSessions(userId) {$/", "language": "JavaScript", "kind": "method", "signature": "(userId)", "scope": "AuthService", "scopeKind": "class"}, {"_type": "tag", "name": "isDriver", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/authService.js", "pattern": "/^      isDriver: user.is_driver$/", "language": "JavaScript", "kind": "property", "scope": "AuthService.generateTokens.payload", "scopeKind": "class"}, {"_type": "tag", "name": "jwt", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/authService.js", "pattern": "/^const jwt = require('jsonwebtoken');$/", "language": "JavaScript", "kind": "constant"}, {"_type": "tag", "name": "logout", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/authService.js", "pattern": "/^  async logout(userId, sessionToken) {$/", "language": "JavaScript", "kind": "method", "signature": "(userId, sessionToken)", "scope": "AuthService", "scopeKind": "class"}, {"_type": "tag", "name": "payload", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/authService.js", "pattern": "/^    const payload = {$/", "language": "JavaScript", "kind": "class", "scope": "AuthService.generateTokens", "scopeKind": "class"}, {"_type": "tag", "name": "refreshToken", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/authService.js", "pattern": "/^  async refreshToken(refreshToken) {$/", "language": "JavaScript", "kind": "method", "signature": "(refreshToken)", "scope": "AuthService", "scopeKind": "class"}, {"_type": "tag", "name": "resetPassword", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/authService.js", "pattern": "/^  async resetPassword(token, newPassword) {$/", "language": "JavaScript", "kind": "method", "signature": "(token, newPassword)", "scope": "AuthService", "scopeKind": "class"}, {"_type": "tag", "name": "userId", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/authService.js", "pattern": "/^      userId: user.id,$/", "language": "JavaScript", "kind": "property", "scope": "AuthService.generateTokens.payload", "scopeKind": "class"}, {"_type": "tag", "name": "validateSession", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/authService.js", "pattern": "/^  async validateSession(sessionToken) {$/", "language": "JavaScript", "kind": "method", "signature": "(sessionToken)", "scope": "AuthService", "scopeKind": "class"}, {"_type": "tag", "name": "verifyEmail", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/authService.js", "pattern": "/^  async verifyEmail(userId, verificationToken) {$/", "language": "JavaScript", "kind": "method", "signature": "(userId, verificationToken)", "scope": "AuthService", "scopeKind": "class"}, {"_type": "tag", "name": "verifyPhone", "path": "/home/kavia/workspace/code-generation/nordic-carpool-platform-89320-89331/blablabil_backend/src/services/authService.js", "pattern": "/^  async verifyPhone(userId, verificationCode) {$/", "language": "JavaScript", "kind": "method", "signature": "(userId, verificationCode)", "scope": "AuthService", "scopeKind": "class"}], "hash": "68b9207bb80ed7ed96d5895b92679183", "format-version": 4, "code-base-name": "blablabil_backend", "filename": "blablabil_backend/src/services/authService.js", "fields": [{"name": "email: user.email,", "scope": "AuthService.generateTokens.payload", "scopeKind": "class", "description": "unavailable"}, {"name": "module.exports = new AuthService();", "scope": "module", "scopeKind": "class", "description": "unavailable"}, {"name": "isDriver: user.is_driver", "scope": "AuthService.generateTokens.payload", "scopeKind": "class", "description": "unavailable"}, {"name": "userId: user.id,", "scope": "AuthService.generateTokens.payload", "scopeKind": "class", "description": "unavailable"}], "revision_history": [{"41": ""}]}